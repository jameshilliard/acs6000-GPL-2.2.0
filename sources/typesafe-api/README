-*- mode: org -*-

Various notes on usage.

* Creating the typesafe api files.

run:
 $ make tsapi_files

** Requirements.
*** parameter tree file
make tsapi_files is expecting the parameter tree in a file named:
   cacpd_dumped_param.conf

To include feature module changes, the parameter tree file needs to be
generated by dumping the tree from cacpd. Cacpd need to be compiled
with '--enable-fe-trace'.

The cacpd command is:
 $ ... cacpd --dump-tree-and-exit > cacpd_dumped_param.conf

*** llconf 
need to ensure llconf can be run.

** TODO put the dump file command into the make file.
need to test for the existence of build machine cacpd, its compiler flags.
need to test for the existence of build machine working llconf.

* Making the library
** TODO need ensure the paths are all correct in the make file.
especially paths to the type_wapper.o and parser-cacpd library.

* Using the TSAPI library.


* Testing.
These tests require cacpd to be running using the ./example
directories.

If tests fail the cacpd example directory needs to be replaced.

** Running cacpd 
 $ cacpd -c ./cacpd-test.conf -n -d5 -C ./examples/ 

** Type safe connection to cacpd.
 $ make test_type_cacpd_client
 $ ./test_type_cacpd_client

*** expected result on stderr:
connecting              test_type_cacpd_client.c:60
calling cacpd           test_type_cacpd_client.c:70
result get : notfoo             test_type_cacpd_client.c:72
doing set               test_type_cacpd_client.c:75
calling get to get the set value cacpd          test_type_cacpd_client.c:80
result get : notfoo             test_type_cacpd_client.c:82
test_type_cacpd_client.c: set suceeded
list: returned: rsa             test_type_cacpd_client.c:36
list: returned: debutante               test_type_cacpd_client.c:36
list: returned: exodus          test_type_cacpd_client.c:36
list: returned: drac            test_type_cacpd_client.c:36
adding: fred_alom               test_type_cacpd_client.c:97
add result: 0           test_type_cacpd_client.c:99
add listing: rsa                test_type_cacpd_client.c:36
add listing: debutante          test_type_cacpd_client.c:36
add listing: exodus             test_type_cacpd_client.c:36
add listing: drac               test_type_cacpd_client.c:36
add listing: fred_alom          test_type_cacpd_client.c:36
renameing: fred_alom            test_type_cacpd_client.c:113
        to: joe_alom            test_type_cacpd_client.c:114
rename result: 0                test_type_cacpd_client.c:116
rename listing: rsa             test_type_cacpd_client.c:36
rename listing: debutante               test_type_cacpd_client.c:36
rename listing: exodus          test_type_cacpd_client.c:36
rename listing: drac            test_type_cacpd_client.c:36
rename listing: joe_alom                test_type_cacpd_client.c:36
commiting               test_type_cacpd_client.c:123
commit listing: rsa             test_type_cacpd_client.c:36
commit listing: debutante               test_type_cacpd_client.c:36
commit listing: exodus          test_type_cacpd_client.c:36
commit listing: drac            test_type_cacpd_client.c:36
commit listing: joe_alom                test_type_cacpd_client.c:36
deleting: joe_alom              test_type_cacpd_client.c:133
got list of: 4          test_type_cacpd_client.c:139
del listing: rsa                test_type_cacpd_client.c:36
del listing: debutante          test_type_cacpd_client.c:36
del listing: exodus             test_type_cacpd_client.c:36
del listing: drac               test_type_cacpd_client.c:36

** Type conversion through the tsapi library
 $ make test_tsapi
 $ ./test_tsapi
*** expected result
fails at present.

* Changing the prefix of functions and filename.
All generated files and functions are currently prepended with:
	'gsp_tsapi_'

In the unfortunate event that this must be changed, the following
[[Change Rules]] need to be followed and [[Files]] need to be adjusted.

** Change Rules
   1. The prefix must end with an '_'. The mk_typesafe_api script
      expects the prefix to end with an underscore, and is coded 
      to remove it certain places. 
   2. In the mk_typesafe_api script, the variable tsapi_prefix
      contains the prefix string. Search for:
      #	typesafe name prefix definition #
   3. You will need to add/edit functions names in
      type_cacpd_client.[ch], especially the commit function.

** Files
 - mk_typesafe_api.py: change tsapi_prefix located at 
     # typesafe name prefix definition #

 - type_cacpd_client.c: function definitions, especially:
     gsp_tsapi_commit, gsp_tsapi_init and gsp_tsapi_destroy

 - type_cacpd_client.h: function prototypes.

 - Makefile: change TSAPI_PRE
